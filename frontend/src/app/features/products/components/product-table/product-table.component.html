<div class="card">
  <div class="font-semibold text-xl mb-4">{{ 'products.title' | translate }}</div>
  <div class="flex justify-content-end mb-4">
    <p-button [label]="'products.btnExport' | translate" icon="pi pi-file-excel" severity="secondary" [outlined]="true" (onClick)="exportExcel()" />
  </div>

  <p-table #dt1 [value]="dataService.products()" dataKey="id" [rows]="10" [rowsPerPageOptions]="[10, 25, 50]" [loading]="loading" [paginator]="true" [globalFilterFields]="globalFilterFields" showGridlines>
    <ng-template pTemplate="caption">
        <div class="flex">
            <p-button label="Clear" [outlined]="true" icon="pi pi-filter-slash" (click)="clear(dt1)" />
            <p-iconfield iconPosition="left" class="ml-auto">
                <p-inputicon>
                    <i class="pi pi-search"></i>
                </p-inputicon>
                <input pInputText type="text" (input)="dt1.filterGlobal($event.target.value, 'contains')" placeholder="Search keyword" />
            </p-iconfield>
        </div>
    </ng-template>
    <ng-template pTemplate="header">
        <tr>
            @for (column of schemaService.visibleColumns(); track column.name) {
                <th [style.min-width]="column.type === 'TEXT' ? '15rem' : '10rem'">
                    <div class="flex items-center justify-between">
                        {{ column.displayName }}
                        <p-columnFilter [type]="getFilterType(column)" [field]="column.name" display="menu" />
                    </div>
                </th>
            }
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-product>
        <tr>
            @for (column of schemaService.visibleColumns(); track column.name) {
                <td>
                    @switch (column.type) {
                        @case (ColumnType.MINIO_IMAGE) {
                            @if (product[column.name]) {
                                <img [src]="product[column.name]" [alt]="column.displayName" class="product-image" style="width: 50px; height: 50px; object-fit: cover;" />
                            } @else {
                                <span class="text-500">{{ 'products.noImage' | translate }}</span>
                            }
                        }
                        @case (ColumnType.BOOLEAN) {
                            <i class="pi" [ngClass]="{
                                'text-green-500 pi-check-circle': product[column.name],
                                'text-red-500 pi-times-circle': !product[column.name]
                            }"></i>
                        }
                        @case (ColumnType.DATE) {
                            {{ product[column.name] | date:'short' }}
                        }
                        @case (ColumnType.DECIMAL) {
                            {{ product[column.name] | number:'1.2-2' }}
                        }
                        @default {
                            {{ product[column.name] }}
                        }
                    }
                </td>
            }
        </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
        <tr>
            <td [attr.colspan]="schemaService.visibleColumns().length">{{ 'products.noResults' | translate }}</td>
        </tr>
    </ng-template>
    <ng-template pTemplate="loadingbody">
        <tr>
            <td [attr.colspan]="schemaService.visibleColumns().length">
                <div class="flex align-items-center justify-content-center p-3">
                    <i class="pi pi-spin pi-spinner mr-2"></i>
                    <span>{{ 'products.loading' | translate }}</span>
                </div>
            </td>
        </tr>
    </ng-template>
  </p-table>
</div>

<p-toast />
