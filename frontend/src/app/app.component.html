<p-menubar>
  <ng-template pTemplate="start">
    <a routerLink="/" class="flex align-items-center gap-2 no-underline text-color">
      <i class="pi pi-shopping-bag text-2xl"></i>
      <span class="font-bold">{{ 'app.title' | translate }}</span>
    </a>
  </ng-template>

  <ng-template pTemplate="end">
    <div class="flex align-items-center gap-2">
        <app-language-switcher></app-language-switcher>
      <ng-container *ngIf="auth.isAuthenticated()">
        <button
          pButton
          type="button"
          icon="pi pi-bell"
          class="p-button-text p-overlay-badge notification-button"
          aria-label="Notifications"
          pBadge
          [value]="badgeCount()"
          [pBadgeHidden]="badgeCount() === 0"
          badgeSeverity="danger"
          (click)="toggleNotifications($event, notificationPanel)"
        ></button>
        <p-overlayPanel #notificationPanel [dismissable]="true" styleClass="notification-panel">
          <div class="notification-header flex justify-content-between align-items-center mb-2">
            <span class="font-medium">{{ 'notifications.title' | translate }}</span>
            <button
              pButton
              type="button"
              class="p-button-text p-button-sm"
              (click)="markAllNotificationsAsRead($event)"
            >
              {{ 'notifications.markAll' | translate }}
            </button>
          </div>
          <div *ngIf="notifications().length; else noNotifications" class="notification-list">
            <div
              *ngFor="let entry of notifications(); trackBy: trackNotification"
              class="notification-item"
              [class.unread]="!entry.read"
              (click)="openNotification(entry, notificationPanel)"
            >
              <div class="notification-icon" [class.insert]="isInsert(entry)">
                <i class="pi pi-box"></i>
              </div>
              <div class="notification-body">
                <div class="notification-title">{{ getNotificationTitle(entry) }}</div>
                <div class="notification-description">{{ getNotificationDescription(entry) }}</div>
                <div class="notification-meta">
                  <span class="timestamp">{{ entry.event.timestamp | date:'short' }}</span>
                  <span *ngIf="!entry.read" class="unread-dot" aria-hidden="true"></span>
                </div>
              </div>
            </div>
          </div>
          <ng-template #noNotifications>
            <div class="notification-empty text-600">{{ 'notifications.empty' | translate }}</div>
          </ng-template>
        </p-overlayPanel>
      </ng-container>
      <ng-container *ngIf="!auth.isAuthenticated(); else userTpl">
        <a *ngIf="!isLoginPage" routerLink="/login" pButton [label]="('app.login' | translate)" icon="pi pi-user" class="p-button-text"></a>
      </ng-container>
      <ng-template #userTpl>
        <button
          pButton
          type="button"
          class="p-button-text flex align-items-center gap-2"
          (click)="userOverlay.toggle($event)"
          aria-haspopup="true"
          [ariaLabel]="auth.username()"
        >
          <p-avatar icon="pi pi-user" shape="circle" size="normal" styleClass="user-avatar"></p-avatar>
          <span class="hidden sm:inline">{{ auth.username() }}</span>
          <i class="pi pi-angle-down" aria-hidden="true"></i>
        </button>
        <p-overlayPanel #userOverlay [dismissable]="true" styleClass="user-menu-panel">
          <button type="button" class="user-menu-item" (click)="logout()">
            <i class="pi pi-sign-out mr-2"></i>
            {{ 'app.logout' | translate }}
          </button>
        </p-overlayPanel>
      </ng-template>
    </div>
  </ng-template>
</p-menubar>

<div class="p-3">
  <router-outlet></router-outlet>
</div>
