<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

# Enhanced Junie Prompt: Products Feature Module with Dynamic Configuration

## Context \& Architecture Overview

You are implementing the **Products Feature Module** for the e-commerce management platform using **Angular 19 standalone components**, **PrimeNG 19 with Sakai template**, and **Angular Signals** for state management. This module follows the platform's **dynamic schema architecture**, where product structure is configured at runtime via Excel/CSV template upload.[^1][^2]

The module must handle **two distinct states**:

1. **Unconfigured State**: When no product schema exists in the database
2. **Configured State**: When product schema is active and ready for data operations

***

## Module Structure

Create the following file structure in `frontend/src/app/features/products/`:

```
features/products/
├── products.routes.ts
├── services/
│   ├── product-schema.service.ts
│   ├── product-data.service.ts
│   └── product-filter.service.ts
├── components/
│   ├── product-container/
│   │   ├── product-container.component.ts
│   │   ├── product-container.component.html
│   │   └── product-container.component.scss
│   ├── schema-configuration/
│   │   ├── schema-configuration.component.ts
│   │   ├── schema-configuration.component.html
│   │   └── schema-configuration.component.scss
│   ├── template-download/
│   │   ├── template-download.component.ts
│   │   ├── template-download.component.html
│   │   └── template-download.component.scss
│   ├── product-table/
│   │   ├── product-table.component.ts
│   │   ├── product-table.component.html
│   │   └── product-table.component.scss
│   ├── product-form/
│   │   ├── product-form.component.ts
│   │   ├── product-form.component.html
│   │   └── product-form.component.scss
│   ├── custom-filter-builder/
│   │   ├── custom-filter-builder.component.ts
│   │   ├── custom-filter-builder.component.html
│   │   └── custom-filter-builder.component.scss
│   └── upload-progress/
│       ├── upload-progress.component.ts
│       ├── upload-progress.component.html
│       └── upload-progress.component.scss
├── models/
│   ├── product-schema.model.ts
│   ├── product.model.ts
│   ├── filter.model.ts
│   └── table-state.model.ts
└── README.md
```


***

## Step 1: Define TypeScript Models

### models/product-schema.model.ts

```typescript
export enum ColumnType {
  TEXT = 'TEXT',
  INTEGER = 'INTEGER',
  DECIMAL = 'DECIMAL',
  DATE = 'DATE',
  BOOLEAN = 'BOOLEAN',
  MINIO_IMAGE = 'MINIO_IMAGE',
  MINIO_FILE = 'MINIO_FILE'
}

export interface ColumnDefinition {
  name: string;
  displayName: string;
  labelKey: string;
  type: ColumnType;
  required: boolean;
  unique: boolean;
  hidden: boolean;
  primaryKey: boolean;
  autoGenerated: boolean;
  maxLength?: number;
  precision?: number;
  scale?: number;
  defaultValue?: string;
  displayOrder: number;
  validationRules?: Record<string, any>;
}

export interface ProductSchema {
  id: number;
  tableName: string;
  displayName: string;
  domain: string;
  version: number;
  status: 'DRAFT' | 'ACTIVE' | 'ARCHIVED';
  columns: ColumnDefinition[];
  metadata?: Record<string, any>;
  createdAt: Date;
  updatedAt?: Date;
}

export interface SchemaConfigurationRequest {
  file: File;
  displayName: string;
  validateBeforeApply: boolean;
}

export interface TemplateValidationResult {
  valid: boolean;
  errors: string[];
  warnings: string[];
}

export interface TemplateUploadProgress {
  uploadId: string;
  percentage: number;
  stage: string;
  message: string;
  timestamp: Date;
}
```


### models/product.model.ts

```typescript
export interface Product {
  id: number;
  [key: string]: any; // Dynamic attributes based on schema
}

export interface ProductPageResponse {
  content: Product[];
  totalElements: number;
  totalPages: number;
  size: number;
  number: number;
  first: boolean;
  last: boolean;
}
```


### models/filter.model.ts

```typescript
export enum FilterOperator {
  EQUALS = 'EQUALS',
  NOT_EQUALS = 'NOT_EQUALS',
  CONTAINS = 'CONTAINS',
  STARTS_WITH = 'STARTS_WITH',
  ENDS_WITH = 'ENDS_WITH',
  GREATER_THAN = 'GREATER_THAN',
  LESS_THAN = 'LESS_THAN',
  GREATER_THAN_OR_EQUAL = 'GREATER_THAN_OR_EQUAL',
  LESS_THAN_OR_EQUAL = 'LESS_THAN_OR_EQUAL',
  BETWEEN = 'BETWEEN',
  IN = 'IN',
  IS_NULL = 'IS_NULL',
  IS_NOT_NULL = 'IS_NOT_NULL'
}

export interface FilterCondition {
  field: string;
  operator: FilterOperator;
  value: any;
  value2?: any; // For BETWEEN operator
}

export interface CustomFilter {
  id?: number;
  name: string;
  entityType: string;
  conditions: FilterCondition[];
  isPublic: boolean;
}

export interface TableLazyLoadEvent {
  first: number;
  rows: number;
  sortField?: string;
  sortOrder?: number;
  filters?: Record<string, any>;
  globalFilter?: string;
}
```


### models/table-state.model.ts

```typescript
export interface TableState {
  first: number;
  rows: number;
  sortField?: string;
  sortOrder: number;
  filters: Record<string, any>;
  globalFilter: string;
}
```


***

## Step 2: Implement Services with Signals

### services/product-schema.service.ts

```typescript
import { Injectable, inject, signal, computed } from '@angular/core';
import { HttpClient, HttpEvent, HttpEventType } from '@angular/common/http';
import { Observable, tap, map, catchError, of } from 'rxjs';
import { toSignal } from '@angular/core/rxjs-interop';
import { environment } from '@env/environment';
import { ProductSchema, SchemaConfigurationRequest, TemplateValidationResult, TemplateUploadProgress } from '../models/product-schema.model';

@Injectable({
  providedIn: 'root'
})
export class ProductSchemaService {
  private readonly http = inject(HttpClient);
  private readonly apiUrl = `${environment.apiBaseUrl}/schemas`;

  // Signals for state management
  private readonly schemaSignal = signal<ProductSchema | null>(null);
  private readonly loadingSignal = signal<boolean>(false);
  private readonly errorSignal = signal<string | null>(null);
  private readonly uploadProgressSignal = signal<number>(0);

  // Public computed signals
  readonly schema = this.schemaSignal.asReadonly();
  readonly isLoading = this.loadingSignal.asReadonly();
  readonly error = this.errorSignal.asReadonly();
  readonly uploadProgress = this.uploadProgressSignal.asReadonly();
  readonly isConfigured = computed(() => this.schemaSignal() !== null && this.schemaSignal()?.status === 'ACTIVE');
  readonly columns = computed(() => this.schemaSignal()?.columns ?? []);
  readonly visibleColumns = computed(() => 
    this.columns().filter(col => !col.hidden).sort((a, b) => a.displayOrder - b.displayOrder)
  );

  /**
   * Load product schema from backend
   */
  loadSchema(): void {
    this.loadingSignal.set(true);
    this.errorSignal.set(null);

    this.http.get<ProductSchema>(`${this.apiUrl}/domain/products`)
      .pipe(
        tap(schema => {
          this.schemaSignal.set(schema);
          this.loadingSignal.set(false);
        }),
        catchError(error => {
          if (error.status === 404) {
            // No schema configured yet
            this.schemaSignal.set(null);
          } else {
            this.errorSignal.set('Failed to load product schema');
          }
          this.loadingSignal.set(false);
          return of(null);
        })
      )
      .subscribe();
  }

  /**
   * Upload Excel/CSV template to configure product schema
   */
  uploadTemplate(request: SchemaConfigurationRequest): Observable<HttpEvent<any>> {
    const formData = new FormData();
    formData.append('file', request.file);
    formData.append('displayName', request.displayName);
    formData.append('validateBeforeApply', request.validateBeforeApply.toString());
    formData.append('domain', 'products');

    this.uploadProgressSignal.set(0);

    return this.http.post<any>(`${this.apiUrl}/upload`, formData, {
      reportProgress: true,
      observe: 'events'
    }).pipe(
      tap(event => {
        if (event.type === HttpEventType.UploadProgress) {
          const progress = event.total ? Math.round((100 * event.loaded) / event.total) : 0;
          this.uploadProgressSignal.set(progress);
        } else if (event.type === HttpEventType.Response) {
          this.uploadProgressSignal.set(100);
          // Reload schema after successful upload
          setTimeout(() => this.loadSchema(), 1000);
        }
      })
    );
  }

  /**
   * Validate template without applying
   */
  validateTemplate(file: File): Observable<TemplateValidationResult> {
    const formData = new FormData();
    formData.append('file', file);

    return this.http.post<TemplateValidationResult>(`${this.apiUrl}/validate`, formData);
  }

  /**
   * Download template example
   */
  downloadTemplate(): void {
    this.http.get(`${this.apiUrl}/template/download`, {
      responseType: 'blob',
      observe: 'response'
    }).subscribe(response => {
      const blob = response.body;
      const filename = this.extractFilename(response.headers.get('content-disposition')) || 'product-template.xlsx';
      this.downloadFile(blob!, filename);
    });
  }

  /**
   * Generate template with all column types as reference
   */
  generateTemplateWithTypes(): void {
    this.http.get(`${this.apiUrl}/template/generate-with-types`, {
      responseType: 'blob',
      observe: 'response'
    }).subscribe(response => {
      const blob = response.body;
      const filename = 'product-template-with-types.xlsx';
      this.downloadFile(blob!, filename);
    });
  }

  private extractFilename(contentDisposition: string | null): string | null {
    if (!contentDisposition) return null;
    const matches = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(contentDisposition);
    return matches && matches[^1] ? matches[^1].replace(/['"]/g, '') : null;
  }

  private downloadFile(blob: Blob, filename: string): void {
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = filename;
    link.click();
    window.URL.revokeObjectURL(url);
  }
}
```


### services/product-data.service.ts

```typescript
import { Injectable, inject, signal } from '@angular/core';
import { HttpClient, HttpParams } from '@angular/common/http';
import { Observable, tap } from 'rxjs';
import { environment } from '@env/environment';
import { Product, ProductPageResponse } from '../models/product.model';
import { TableLazyLoadEvent } from '../models/filter.model';

@Injectable({
  providedIn: 'root'
})
export class ProductDataService {
  private readonly http = inject(HttpClient);
  private readonly apiUrl = `${environment.apiBaseUrl}/products`;

  private readonly productsSignal = signal<Product[]>([]);
  private readonly totalRecordsSignal = signal<number>(0);
  private readonly loadingSignal = signal<boolean>(false);

  readonly products = this.productsSignal.asReadonly();
  readonly totalRecords = this.totalRecordsSignal.asReadonly();
  readonly isLoading = this.loadingSignal.asReadonly();

  /**
   * Load products with server-side pagination, sorting, filtering
   */
  loadProducts(event: TableLazyLoadEvent, customFilterId?: number): Observable<ProductPageResponse> {
    this.loadingSignal.set(true);

    let params = new HttpParams()
      .set('page', Math.floor(event.first / event.rows))
      .set('size', event.rows);

    // Sorting
    if (event.sortField) {
      const sortDirection = event.sortOrder === 1 ? 'asc' : 'desc';
      params = params.set('sort', `${event.sortField},${sortDirection}`);
    }

    // Global search
    if (event.globalFilter) {
      params = params.set('search', event.globalFilter);
    }

    // Column filters
    if (event.filters) {
      Object.keys(event.filters).forEach(key => {
        const filterValue = event.filters![key];
        if (filterValue?.value !== null && filterValue?.value !== undefined) {
          params = params.set(`filter.${key}`, filterValue.value);
        }
      });
    }

    // Custom filter
    if (customFilterId) {
      params = params.set('customFilterId', customFilterId);
    }

    return this.http.get<ProductPageResponse>(this.apiUrl, { params }).pipe(
      tap(response => {
        this.productsSignal.set(response.content);
        this.totalRecordsSignal.set(response.totalElements);
        this.loadingSignal.set(false);
      })
    );
  }

  /**
   * Get product by ID
   */
  getProduct(id: number): Observable<Product> {
    return this.http.get<Product>(`${this.apiUrl}/${id}`);
  }

  /**
   * Create new product
   */
  createProduct(product: Partial<Product>): Observable<Product> {
    return this.http.post<Product>(this.apiUrl, product);
  }

  /**
   * Update existing product
   */
  updateProduct(id: number, product: Partial<Product>): Observable<Product> {
    return this.http.put<Product>(`${this.apiUrl}/${id}`, product);
  }

  /**
   * Delete product
   */
  deleteProduct(id: number): Observable<void> {
    return this.http.delete<void>(`${this.apiUrl}/${id}`);
  }

  /**
   * Bulk delete products
   */
  bulkDelete(ids: number[]): Observable<void> {
    return this.http.post<void>(`${this.apiUrl}/bulk-delete`, { ids });
  }

  /**
   * Export products to Excel
   */
  exportToExcel(filters?: any): void {
    let params = new HttpParams();
    if (filters) {
      Object.keys(filters).forEach(key => {
        params = params.set(key, filters[key]);
      });
    }

    this.http.get(`${this.apiUrl}/export`, {
      params,
      responseType: 'blob',
      observe: 'response'
    }).subscribe(response => {
      const blob = response.body;
      const filename = `products-export-${new Date().getTime()}.xlsx`;
      this.downloadFile(blob!, filename);
    });
  }

  private downloadFile(blob: Blob, filename: string): void {
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = filename;
    link.click();
    window.URL.revokeObjectURL(url);
  }
}
```


### services/product-filter.service.ts

```typescript
import { Injectable, inject, signal } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable, tap } from 'rxjs';
import { environment } from '@env/environment';
import { CustomFilter } from '../models/filter.model';

@Injectable({
  providedIn: 'root'
})
export class ProductFilterService {
  private readonly http = inject(HttpClient);
  private readonly apiUrl = `${environment.apiBaseUrl}/filters`;

  private readonly filtersSignal = signal<CustomFilter[]>([]);
  private readonly activeFilterSignal = signal<CustomFilter | null>(null);

  readonly filters = this.filtersSignal.asReadonly();
  readonly activeFilter = this.activeFilterSignal.asReadonly();

  /**
   * Load all user filters for products
   */
  loadFilters(): void {
    this.http.get<CustomFilter[]>(`${this.apiUrl}?entityType=products`)
      .pipe(tap(filters => this.filtersSignal.set(filters)))
      .subscribe();
  }

  /**
   * Save new custom filter
   */
  saveFilter(filter: CustomFilter): Observable<CustomFilter> {
    return this.http.post<CustomFilter>(this.apiUrl, {
      ...filter,
      entityType: 'products'
    }).pipe(
      tap(() => this.loadFilters())
    );
  }

  /**
   * Update existing filter
   */
  updateFilter(id: number, filter: CustomFilter): Observable<CustomFilter> {
    return this.http.put<CustomFilter>(`${this.apiUrl}/${id}`, filter).pipe(
      tap(() => this.loadFilters())
    );
  }

  /**
   * Delete filter
   */
  deleteFilter(id: number): Observable<void> {
    return this.http.delete<void>(`${this.apiUrl}/${id}`).pipe(
      tap(() => {
        this.loadFilters();
        if (this.activeFilterSignal()?.id === id) {
          this.activeFilterSignal.set(null);
        }
      })
    );
  }

  /**
   * Set active filter
   */
  setActiveFilter(filter: CustomFilter | null): void {
    this.activeFilterSignal.set(filter);
  }
}
```


***

## Step 3: Component Implementation

### components/product-container/product-container.component.ts

```typescript
import { Component, OnInit, inject, effect } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ProductSchemaService } from '../../services/product-schema.service';
import { SchemaConfigurationComponent } from '../schema-configuration/schema-configuration.component';
import { ProductTableComponent } from '../product-table/product-table.component';
import { CardModule } from 'primeng/card';
import { ProgressSpinnerModule } from 'primeng/progressspinner';
import { MessageModule } from 'primeng/message';

@Component({
  selector: 'app-product-container',
  standalone: true,
  imports: [
    CommonModule,
    CardModule,
    ProgressSpinnerModule,
    MessageModule,
    SchemaConfigurationComponent,
    ProductTableComponent
  ],
  templateUrl: './product-container.component.html',
  styleUrls: ['./product-container.component.scss']
})
export class ProductContainerComponent implements OnInit {
  readonly schemaService = inject(ProductSchemaService);

  ngOnInit(): void {
    this.schemaService.loadSchema();
  }
}
```


### components/product-container/product-container.component.html

```html
<div class="product-container">
  @if (schemaService.isLoading()) {
    <div class="flex justify-content-center align-items-center" style="min-height: 400px;">
      <p-progressSpinner />
    </div>
  } @else if (schemaService.error()) {
    <p-message severity="error" [text]="schemaService.error()!" styleClass="w-full" />
  } @else if (!schemaService.isConfigured()) {
    <!-- Unconfigured State: Show configuration wizard -->
    <app-schema-configuration />
  } @else {
    <!-- Configured State: Show product table -->
    <app-product-table />
  }
</div>
```


### components/schema-configuration/schema-configuration.component.ts

```typescript
import { Component, inject, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { ProductSchemaService } from '../../services/product-schema.service';
import { SchemaConfigurationRequest } from '../../models/product-schema.model';
import { CardModule } from 'primeng/card';
import { FileUploadModule, FileUploadHandlerEvent } from 'primeng/fileupload';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { CheckboxModule } from 'primeng/checkbox';
import { MessageModule } from 'primeng/message';
import { ProgressBarModule } from 'primeng/progressbar';
import { DividerModule } from 'primeng/divider';
import { MessageService } from 'primeng/api';
import { ToastModule } from 'primeng/toast';
import { TemplateDownloadComponent } from '../template-download/template-download.component';
import { UploadProgressComponent } from '../upload-progress/upload-progress.component';
import { HttpEventType } from '@angular/common/http';

@Component({
  selector: 'app-schema-configuration',
  standalone: true,
  imports: [
    CommonModule,
    FormsModule,
    CardModule,
    FileUploadModule,
    ButtonModule,
    InputTextModule,
    CheckboxModule,
    MessageModule,
    ProgressBarModule,
    DividerModule,
    ToastModule,
    TemplateDownloadComponent,
    UploadProgressComponent
  ],
  providers: [MessageService],
  templateUrl: './schema-configuration.component.html',
  styleUrls: ['./schema-configuration.component.scss']
})
export class SchemaConfigurationComponent {
  private readonly schemaService = inject(ProductSchemaService);
  private readonly messageService = inject(MessageService);

  readonly displayName = signal<string>('Products');
  readonly validateBeforeApply = signal<boolean>(true);
  readonly selectedFile = signal<File | null>(null);
  readonly isUploading = signal<boolean>(false);

  onFileSelect(event: any): void {
    const file = event.files[^0];
    if (file) {
      this.selectedFile.set(file);
      this.messageService.add({
        severity: 'info',
        summary: 'File Selected',
        detail: `${file.name} (${this.formatFileSize(file.size)})`
      });
    }
  }

  onFileRemove(): void {
    this.selectedFile.set(null);
  }

  uploadTemplate(): void {
    const file = this.selectedFile();
    if (!file) {
      this.messageService.add({
        severity: 'warn',
        summary: 'No File',
        detail: 'Please select a file to upload'
      });
      return;
    }

    const request: SchemaConfigurationRequest = {
      file,
      displayName: this.displayName(),
      validateBeforeApply: this.validateBeforeApply()
    };

    this.isUploading.set(true);

    this.schemaService.uploadTemplate(request).subscribe({
      next: (event) => {
        if (event.type === HttpEventType.Response) {
          this.isUploading.set(false);
          this.messageService.add({
            severity: 'success',
            summary: 'Success',
            detail: 'Product schema configured successfully'
          });
          this.selectedFile.set(null);
        }
      },
      error: (error) => {
        this.isUploading.set(false);
        this.messageService.add({
          severity: 'error',
          summary: 'Upload Failed',
          detail: error.error?.message || 'Failed to upload template'
        });
      }
    });
  }

  private formatFileSize(bytes: number): string {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
  }
}
```


### components/schema-configuration/schema-configuration.component.html

```html
<div class="grid">
  <div class="col-12">
    <p-card header="Configure Products" subheader="Upload an Excel or CSV template to define your product structure">
      <p-message 
        severity="info" 
        text="Products are not configured yet. Please upload a template to get started." 
        styleClass="w-full mb-4" 
      />

      <!-- Template Download Section -->
      <app-template-download />

      <p-divider />

      <!-- Upload Section -->
      <div class="upload-section">
        <h3>Upload Configuration Template</h3>
        
        <div class="field">
          <label for="displayName">Display Name</label>
          <input 
            id="displayName" 
            type="text" 
            pInputText 
            [(ngModel)]="displayName"
            placeholder="e.g., Products"
            class="w-full"
          />
        </div>

        <div class="field-checkbox mb-4">
          <p-checkbox 
            [(ngModel)]="validateBeforeApply" 
            [binary]="true" 
            inputId="validate"
          />
          <label for="validate" class="ml-2">Validate template before applying changes</label>
        </div>

        <p-fileUpload
          name="template"
          [customUpload]="true"
          (onSelect)="onFileSelect($event)"
          (onRemove)="onFileRemove()"
          accept=".xlsx,.xls,.csv"
          [maxFileSize]="10000000"
          [showUploadButton]="false"
          [showCancelButton]="false"
          [auto]="false"
        >
          <ng-template pTemplate="content">
            <div class="flex align-items-center justify-content-center flex-column">
              @if (!selectedFile()) {
                <i class="pi pi-cloud-upload text-6xl text-primary"></i>
                <p class="mt-3 mb-0">Drag and drop files here or click to browse</p>
                <p class="text-500">Accepted formats: .xlsx, .xls, .csv (Max 10MB)</p>
              } @else {
                <div class="flex align-items-center gap-3">
                  <i class="pi pi-file-excel text-4xl text-green-500"></i>
                  <div>
                    <p class="font-bold mb-1">{{ selectedFile()!.name }}</p>
                    <p class="text-500 text-sm">{{ formatFileSize(selectedFile()!.size) }}</p>
                  </div>
                </div>
              }
            </div>
          </ng-template>
        </p-fileUpload>

        @if (isUploading()) {
          <app-upload-progress [progress]="schemaService.uploadProgress()" />
        }

        <div class="flex justify-content-end mt-4">
          <p-button
            label="Configure Products"
            icon="pi pi-check"
            [disabled]="!selectedFile() || isUploading()"
            [loading]="isUploading()"
            (onClick)="uploadTemplate()"
          />
        </div>
      </div>
    </p-card>
  </div>
</div>

<p-toast />
```


### components/template-download/template-download.component.ts

```typescript
import { Component, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ProductSchemaService } from '../../services/product-schema.service';
import { CardModule } from 'primeng/card';
import { ButtonModule } from 'primeng/button';
import { DividerModule } from 'primeng/divider';

@Component({
  selector: 'app-template-download',
  standalone: true,
  imports: [CommonModule, CardModule, ButtonModule, DividerModule],
  template: `
    <div class="template-download-section">
      <h3>Download Template Examples</h3>
      <p class="text-600 mb-3">
        Download a template to see the expected format. The template includes:
      </p>
      <ul class="text-600 mb-4">
        <li><strong>Row 1:</strong> Column names (e.g., name, sku, price, quantity)</li>
        <li><strong>Row 2:</strong> Column types (TEXT, INTEGER, DECIMAL, DATE, BOOLEAN, MINIO_IMAGE, MINIO_FILE)</li>
        <li><strong>Row 3+:</strong> Optional sample data</li>
      </ul>

      <div class="flex gap-3">
        <p-button
          label="Download Basic Template"
          icon="pi pi-download"
          severity="secondary"
          [outlined]="true"
          (onClick)="downloadBasicTemplate()"
        />
        <p-button
          label="Download Template with All Types"
          icon="pi pi-download"
          severity="secondary"
          [outlined]="true"
          (onClick)="downloadTemplateWithTypes()"
          pTooltip="Includes all available column types with examples"
          tooltipPosition="top"
        />
      </div>
    </div>
  `,
  styles: [`
    .template-download-section {
      padding: 1rem;
      background: var(--surface-50);
      border-radius: var(--border-radius);
    }
    ul {
      padding-left: 1.5rem;
    }
    li {
      margin-bottom: 0.5rem;
    }
  `]
})
export class TemplateDownloadComponent {
  private readonly schemaService = inject(ProductSchemaService);

  downloadBasicTemplate(): void {
    this.schemaService.downloadTemplate();
  }

  downloadTemplateWithTypes(): void {
    this.schemaService.generateTemplateWithTypes();
  }
}
```


### components/upload-progress/upload-progress.component.ts

```typescript
import { Component, input } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ProgressBarModule } from 'primeng/progressbar';

@Component({
  selector: 'app-upload-progress',
  standalone: true,
  imports: [CommonModule, ProgressBarModule],
  template: `
    <div class="upload-progress mt-3">
      <p-progressBar [value]="progress()" [showValue]="true" />
      <p class="text-center text-sm text-500 mt-2">Uploading and processing template...</p>
    </div>
  `
})
export class UploadProgressComponent {
  readonly progress = input.required<number>();
}
```


### components/product-table/product-table.component.ts

```typescript
import { Component, OnInit, inject, signal, computed } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { ProductSchemaService } from '../../services/product-schema.service';
import { ProductDataService } from '../../services/product-data.service';
import { ProductFilterService } from '../../services/product-filter.service';
import { Product } from '../../models/product.model';
import { TableLazyLoadEvent, TableState } from '../../models/filter.model';
import { TableModule, TableLazyLoadEvent as PrimeNGTableLazyLoadEvent } from 'primeng/table';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { ToolbarModule } from 'primeng/toolbar';
import { ConfirmDialogModule } from 'primeng/confirmdialog';
import { ToastModule } from 'primeng/toast';
import { ConfirmationService, MessageService } from 'primeng/api';
import { CustomFilterBuilderComponent } from '../custom-filter-builder/custom-filter-builder.component';
import { DialogModule } from 'primeng/dialog';
import { ProductFormComponent } from '../product-form/product-form.component';

@Component({
  selector: 'app-product-table',
  standalone: true,
  imports: [
    CommonModule,
    FormsModule,
    TableModule,
    ButtonModule,
    InputTextModule,
    ToolbarModule,
    ConfirmDialogModule,
    ToastModule,
    DialogModule,
    CustomFilterBuilderComponent,
    ProductFormComponent
  ],
  providers: [ConfirmationService, MessageService],
  templateUrl: './product-table.component.html',
  styleUrls: ['./product-table.component.scss']
})
export class ProductTableComponent implements OnInit {
  readonly schemaService = inject(ProductSchemaService);
  readonly dataService = inject(ProductDataService);
  readonly filterService = inject(ProductFilterService);
  private readonly confirmationService = inject(ConfirmationService);
  private readonly messageService = inject(MessageService);

  readonly selectedProducts = signal<Product[]>([]);
  readonly showFilterBuilder = signal<boolean>(false);
  readonly showProductForm = signal<boolean>(false);
  readonly editingProduct = signal<Product | null>(null);
  readonly globalFilterValue = signal<string>('');

  readonly tableState = signal<TableState>({
    first: 0,
    rows: 10,
    sortField: undefined,
    sortOrder: 1,
    filters: {},
    globalFilter: ''
  });

  ngOnInit(): void {
    this.filterService.loadFilters();
  }

  onLazyLoad(event: PrimeNGTableLazyLoadEvent): void {
    const lazyEvent: TableLazyLoadEvent = {
      first: event.first ?? 0,
      rows: event.rows ?? 10,
      sortField: event.sortField as string | undefined,
      sortOrder: event.sortOrder,
      filters: event.filters,
      globalFilter: this.globalFilterValue()
    };

    this.tableState.set({
      first: lazyEvent.first,
      rows: lazyEvent.rows,
      sortField: lazyEvent.sortField,
      sortOrder: lazyEvent.sortOrder ?? 1,
      filters: lazyEvent.filters ?? {},
      globalFilter: lazyEvent.globalFilter ?? ''
    });

    const activeFilter = this.filterService.activeFilter();
    this.dataService.loadProducts(lazyEvent, activeFilter?.id).subscribe();
  }

  onGlobalFilter(event: Event): void {
    const value = (event.target as HTMLInputElement).value;
    this.globalFilterValue.set(value);
    // Trigger table reload
    this.onLazyLoad({
      first: 0,
      rows: this.tableState().rows
    } as PrimeNGTableLazyLoadEvent);
  }

  openNew(): void {
    this.editingProduct.set(null);
    this.showProductForm.set(true);
  }

  editProduct(product: Product): void {
    this.editingProduct.set(product);
    this.showProductForm.set(true);
  }

  deleteProduct(product: Product): void {
    this.confirmationService.confirm({
      message: `Are you sure you want to delete this product?`,
      header: 'Confirm Delete',
      icon: 'pi pi-exclamation-triangle',
      accept: () => {
        this.dataService.deleteProduct(product.id).subscribe({
          next: () => {
            this.messageService.add({
              severity: 'success',
              summary: 'Success',
              detail: 'Product deleted successfully'
            });
            this.refreshTable();
          },
          error: () => {
            this.messageService.add({
              severity: 'error',
              summary: 'Error',
              detail: 'Failed to delete product'
            });
          }
        });
      }
    });
  }

  deleteSelectedProducts(): void {
    const selected = this.selectedProducts();
    if (selected.length === 0) return;

    this.confirmationService.confirm({
      message: `Are you sure you want to delete ${selected.length} product(s)?`,
      header: 'Confirm Bulk Delete',
      icon: 'pi pi-exclamation-triangle',
      accept: () => {
        const ids = selected.map(p => p.id);
        this.dataService.bulkDelete(ids).subscribe({
          next: () => {
            this.messageService.add({
              severity: 'success',
              summary: 'Success',
              detail: `${selected.length} product(s) deleted successfully`
            });
            this.selectedProducts.set([]);
            this.refreshTable();
          },
          error: () => {
            this.messageService.add({
              severity: 'error',
              summary: 'Error',
              detail: 'Failed to delete products'
            });
          }
        });
      }
    });
  }

  exportExcel(): void {
    this.dataService.exportToExcel(this.tableState().filters);
    this.messageService.add({
      severity: 'info',
      summary: 'Export Started',
      detail: 'Preparing Excel file for download...'
    });
  }

  openFilterBuilder(): void {
    this.showFilterBuilder.set(true);
  }

  onFilterApplied(): void {
    this.showFilterBuilder.set(false);
    this.refreshTable();
  }

  onProductSaved(): void {
    this.showProductForm.set(false);
    this.refreshTable();
  }

  private refreshTable(): void {
    this.onLazyLoad({
      first: this.tableState().first,
      rows: this.tableState().rows,
      sortField: this.tableState().sortField,
      sortOrder: this.tableState().sortOrder
    } as PrimeNGTableLazyLoadEvent);
  }
}
```


### components/product-table/product-table.component.html

```html
<div class="card">
  <!-- Toolbar -->
  <p-toolbar styleClass="mb-4">
    <ng-template pTemplate="left">
      <p-button 
        label="New" 
        icon="pi pi-plus" 
        severity="success" 
        class="mr-2"
        (onClick)="openNew()"
      />
      <p-button 
        label="Delete" 
        icon="pi pi-trash" 
        severity="danger"
        [disabled]="!selectedProducts().length"
        (onClick)="deleteSelectedProducts()"
      />
    </ng-template>

    <ng-template pTemplate="right">
      <p-button 
        label="Custom Filters" 
        icon="pi pi-filter" 
        severity="secondary"
        [outlined]="true"
        class="mr-2"
        (onClick)="openFilterBuilder()"
      />
      <p-button 
        label="Export" 
        icon="pi pi-file-excel" 
        severity="secondary"
        [outlined]="true"
        (onClick)="exportExcel()"
      />
    </ng-template>
  </p-toolbar>

  <!-- Data Table -->
  <p-table
    [value]="dataService.products()"
    [lazy]="true"
    [paginator]="true"
    [rows]="10"
    [totalRecords]="dataService.totalRecords()"
    [loading]="dataService.isLoading()"
    [rowsPerPageOptions]="[10, 25, 50, 100]"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
    [globalFilterFields]="schemaService.visibleColumns().map(col => col.name)"
    [(selection)]="selectedProducts"
    [rowHover]="true"
    dataKey="id"
    (onLazyLoad)="onLazyLoad($event)"
    styleClass="p-datatable-gridlines"
  >
    <!-- Caption with Search -->
    <ng-template pTemplate="caption">
      <div class="flex align-items-center justify-content-between">
        <h5 class="m-0">Products</h5>
        <span class="p-input-icon-left">
          <i class="pi pi-search"></i>
          <input 
            pInputText 
            type="text" 
            (input)="onGlobalFilter($event)"
            placeholder="Search..." 
          />
        </span>
      </div>
    </ng-template>

    <!-- Table Header -->
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 4rem">
          <p-tableHeaderCheckbox />
        </th>
        @for (column of schemaService.visibleColumns(); track column.name) {
          <th [pSortableColumn]="column.name">
            {{ column.displayName }}
            <p-sortIcon [field]="column.name" />
          </th>
        }
        <th style="width: 12rem">Actions</th>
      </tr>
      <tr>
        <th></th>
        @for (column of schemaService.visibleColumns(); track column.name) {
          <th>
            <p-columnFilter 
              type="text" 
              [field]="column.name" 
              display="menu"
            />
          </th>
        }
        <th></th>
      </tr>
    </ng-template>

    <!-- Table Body -->
    <ng-template pTemplate="body" let-product>
      <tr>
        <td>
          <p-tableCheckbox [value]="product" />
        </td>
        @for (column of schemaService.visibleColumns(); track column.name) {
          <td>
            @if (column.type === 'MINIO_IMAGE') {
              @if (product[column.name]) {
                <img 
                  [src]="product[column.name]" 
                  [alt]="column.displayName"
                  class="product-image"
                  style="width: 50px; height: 50px; object-fit: cover;"
                />
              } @else {
                <span class="text-500">No image</span>
              }
            } @else if (column.type === 'BOOLEAN') {
              <i 
                [class]="product[column.name] ? 'pi pi-check text-green-500' : 'pi pi-times text-red-500'"
              ></i>
            } @else if (column.type === 'DATE') {
              {{ product[column.name] | date:'short' }}
            } @else if (column.type === 'DECIMAL') {
              {{ product[column.name] | number:'1.2-2' }}
            } @else {
              {{ product[column.name] }}
            }
          </td>
        }
        <td>
          <p-button 
            icon="pi pi-pencil" 
            [rounded]="true" 
            [text]="true" 
            severity="info"
            (onClick)="editProduct(product)"
            pTooltip="Edit"
          />
          <p-button 
            icon="pi pi-trash" 
            [rounded]="true" 
            [text]="true" 
            severity="danger"
            (onClick)="deleteProduct(product)"
            pTooltip="Delete"
          />
        </td>
      </tr>
    </ng-template>

    <!-- Empty Message -->
    <ng-template pTemplate="emptymessage">
      <tr>
        <td [attr.colspan]="schemaService.visibleColumns().length + 2">
          <div class="flex align-items-center justify-content-center flex-column p-5">
            <i class="pi pi-inbox text-6xl text-400 mb-3"></i>
            <p class="text-600">No products found</p>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Filter Builder Dialog -->
<p-dialog
  header="Custom Filter Builder"
  [(visible)]="showFilterBuilder"
  [modal]="true"
  [style]="{ width: '50vw' }"
  [draggable]="false"
  [resizable]="false"
>
  <app-custom-filter-builder 
    (filterApplied)="onFilterApplied()"
    (cancel)="showFilterBuilder.set(false)"
  />
</p-dialog>

<!-- Product Form Dialog -->
<p-dialog
  [header]="editingProduct() ? 'Edit Product' : 'New Product'"
  [(visible)]="showProductForm"
  [modal]="true"
  [style]="{ width: '70vw' }"
  [draggable]="false"
  [resizable]="false"
>
  <app-product-form
    [product]="editingProduct()"
    (saved)="onProductSaved()"
    (cancel)="showProductForm.set(false)"
  />
</p-dialog>

<p-confirmDialog />
<p-toast />
```


***

## Step 4: Routing Configuration

### products.routes.ts

```typescript
import { Routes } from '@angular/router';
import { AuthGuard } from '@core/guards/auth.guard';
import { PermissionGuard } from '@core/guards/permission.guard';

export const PRODUCT_ROUTES: Routes = [
  {
    path: '',
    canActivate: [AuthGuard, PermissionGuard],
    data: { permission: 'READ_PRODUCTS' },
    loadComponent: () => 
      import('./components/product-container/product-container.component')
        .then(m => m.ProductContainerComponent)
  }
];
```


***

## Validation Checklist

Before submitting to Junie, ensure:

- [ ] All TypeScript models are properly typed with enums and interfaces
- [ ] Services use Angular 19 signals for reactive state management
- [ ] Components use `input()` and `output()` signal-based APIs
- [ ] PrimeNG 19 components are imported correctly
- [ ] Lazy loading is implemented server-side with proper pagination
- [ ] File upload handles Excel/CSV with progress tracking
- [ ] Template download generates proper format with types in row 2
- [ ] Table dynamically generates columns based on schema
- [ ] Custom filters can be created, saved, and applied
- [ ] All CRUD operations are implemented
- [ ] Error handling and loading states are managed
- [ ] Confirmation dialogs for delete operations
- [ ] Export to Excel functionality works
- [ ] Responsive design with Sakai theme
- [ ] Accessibility features included
- [ ] No hardcoded values, all configurable via schema

***

This enhanced prompt provides Junie with comprehensive, production-ready implementation details following Angular 19 and PrimeNG 19 best practices with signals-based reactive architecture.[^3][^4][^2][^1]
<span style="display:none">[^10][^11][^12][^13][^14][^15][^16][^17][^18][^19][^20][^21][^5][^6][^7][^8][^9]</span>

<div align="center">⁂</div>

[^1]: https://angular.dev/guide/signals

[^2]: https://dev.to/cristiansifuentes/building-a-professional-angular-19-app-using-signals-and-services-3gl4

[^3]: https://dev.to/cristiansifuentes/building-reactive-uis-with-angular-signals-a-practical-profile-editor-angular-19-5g34

[^4]: https://primeng.org/table

[^5]: https://angular.dev/guide/forms/reactive-forms

[^6]: https://www.reddit.com/r/Angular2/comments/1iom17e/do_reactive_forms_work_with_signals_yet/

[^7]: https://stackoverflow.com/questions/79464912/how-to-set-up-angular-reactive-forms-with-signals

[^8]: https://www.thisdot.co/blog/exploring-angular-forms-a-new-alternative-with-signals

[^9]: https://stackoverflow.com/questions/78189979/primeng-p-table-lazy-load-does-not-update-without-extra-click

[^10]: https://www.geeksforgeeks.org/angular-js/angular-primeng-fileupload-templates/

[^11]: https://blog.lunatech.com/posts/2025-05-20-part-4:-angular-19-deep-dive-–-smarter-forms-with-signals-and-control-flow

[^12]: https://primeng.org/fileupload

[^13]: https://github.com/Gentleman-Programming/angular-signals-reactive-form

[^14]: https://www.youtube.com/watch?v=XXsiLoUG7Sg

[^15]: https://codesandbox.io/p/sandbox/primeng-file-upload-advanced-demo-mrzfwk

[^16]: https://github.com/primefaces/primeng/issues/16745

[^17]: https://www.geeksforgeeks.org/angular-js/angular-primeng-fileupload-templating/

[^18]: https://stackblitz.com/edit/stackblitz-starters-ynwhlt9w

[^19]: https://primeng.org/paginator

[^20]: https://stackoverflow.com/questions/73295132/how-do-i-bind-a-primeng-file-upload-component-to-my-angular-form-control

[^21]: https://stackblitz.com/edit/angular-at-6hsnzb?file=src%2Fmain.ts

